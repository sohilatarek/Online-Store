<div class="categories-list-container">
  <div class="card">
    <div class="card-header">
      <h5 class="card-title">
        <i class="fa fa-folder-open me-2"></i>Categories Management
      </h5>
    </div>
    <div class="card-body">
      <!-- Search and Filter Form -->
      <form [formGroup]="searchForm" (ngSubmit)="search()" class="search-filters">
        <div class="filter-row">
          <div class="form-group">
            <label class="form-label">
              <i class="fa fa-search me-1"></i>Search
            </label>
            <input 
              type="text" 
              class="form-control" 
              formControlName="searchTerm" 
              placeholder="Name or Description"
            />
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fa fa-toggle-on me-1"></i>Status
            </label>
            <select class="form-select" formControlName="isActive">
              <option [value]="null">All</option>
              <option [value]="true">Active</option>
              <option [value]="false">Inactive</option>
            </select>
          </div>
          <div class="form-group d-flex align-items-end">
            <div class="filter-actions" style="width: 100%;">
              <button type="submit" class="btn btn-primary" [disabled]="loading">
                <i class="fa fa-search me-2"></i>Search
              </button>
              <button type="button" class="btn btn-secondary" (click)="resetFilters()" [disabled]="loading">
                <i class="fa fa-refresh me-2"></i>Reset
              </button>
              @if(canCreate) {
                <button type="button" class="btn btn-success" (click)="addCategory()">
                  <i class="fa fa-plus me-2"></i>Add Category
                </button>
              }
            </div>
          </div>
        </div>
      </form>

      <!-- Loading Indicator -->
      @if(loading) {
        <div class="loading-container">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="loading-text">Loading categories...</p>
        </div>
      }

      <!-- Categories Table -->
      @if(!loading && categories.length > 0) {
        <div class="categories-table-wrapper">
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th style="cursor: pointer" (click)="onSort('displayOrder')">
                    Order {{ getSortIcon('displayOrder') }}
                  </th>
                  <th style="cursor: pointer" (click)="onSort('nameEn')">
                    Category Name {{ getSortIcon('nameEn') }}
                  </th>
                  <th>Description</th>
                  <th>Products</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                @for(category of categories; track category.id) {
                  <tr>
                    <td>
                      <span class="badge badge-info">{{ category.displayOrder }}</span>
                    </td>
                    <td>
                      <div class="category-name">
                        {{ category.nameEn || category.nameAr }}
                        @if(category.nameAr && category.nameEn) {
                          <div class="category-name-ar">{{ category.nameAr }}</div>
                        }
                      </div>
                    </td>
                    <td>
                      <div class="description-preview" [title]="category.descriptionEn || category.descriptionAr">
                        {{ category.descriptionEn || category.descriptionAr }}
                      </div>
                    </td>
                    <td>
                      <span class="product-count-badge">
                        <i class="fa fa-box"></i>
                        {{ category.productCount }} product{{ category.productCount !== 1 ? 's' : '' }}
                      </span>
                    </td>
                    <td>
                      <div class="status-badges">
                        <span [class]="'badge ' + (category.isActive ? 'badge-success' : 'badge-secondary')">
                          {{ category.isActive ? 'Active' : 'Inactive' }}
                        </span>
                      </div>
                    </td>
                    <td>
                      <div class="action-buttons">
                        @if(canEdit) {
                          <button 
                            class="btn btn-outline-primary btn-sm" 
                            (click)="editCategory(category.id)"
                            title="Edit Category"
                          >
                            <i class="fa fa-edit"></i>
                          </button>
                          @if(category.isActive) {
                            <button 
                              class="btn btn-outline-warning btn-sm" 
                              (click)="deactivateCategory(category)"
                              title="Deactivate Category"
                            >
                              <i class="fa fa-ban"></i>
                            </button>
                          } @else {
                            <button 
                              class="btn btn-outline-success btn-sm" 
                              (click)="activateCategory(category)"
                              title="Activate Category"
                            >
                              <i class="fa fa-check"></i>
                            </button>
                          }
                        }
                        @if(canDelete) {
                          <button 
                            class="btn btn-outline-danger btn-sm" 
                            (click)="deleteCategory(category)"
                            title="Delete Category"
                          >
                            <i class="fa fa-trash"></i>
                          </button>
                        }
                      </div>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>

        <!-- Pagination -->
        @if(getTotalPages() > 1) {
          <div class="pagination-wrapper">
            <nav aria-label="Categories pagination">
              <ul class="pagination">
                <li class="page-item" [class.disabled]="page === 1">
                  <a class="page-link" (click)="onPageChange(page - 1)" style="cursor: pointer">
                    <i class="fa fa-chevron-left"></i>
                  </a>
                </li>
                @for(pageNum of getPageNumbers(); track pageNum) {
                  <li class="page-item" [class.active]="page === pageNum">
                    <a class="page-link" (click)="onPageChange(pageNum)" style="cursor: pointer">{{ pageNum }}</a>
                  </li>
                }
                <li class="page-item" [class.disabled]="page === getTotalPages()">
                  <a class="page-link" (click)="onPageChange(page + 1)" style="cursor: pointer">
                    <i class="fa fa-chevron-right"></i>
                  </a>
                </li>
              </ul>
            </nav>
            <div class="pagination-info">
              Showing {{ getDisplayRange() }} of {{ totalCount }} categories
            </div>
          </div>
        }
      }

      <!-- Empty State -->
      @if(!loading && categories.length === 0) {
        <div class="empty-state">
          <div class="empty-icon">
            <i class="fa fa-folder-open"></i>
          </div>
          <h3 class="empty-title">No Categories Found</h3>
          <p class="empty-message">
            @if(canCreate) {
              Get started by creating your first category.
            } @else {
              No categories match your search criteria. Try adjusting your filters.
            }
          </p>
          @if(canCreate) {
            <button class="btn btn-primary" (click)="addCategory()">
              <i class="fa fa-plus me-2"></i>Create Your First Category
            </button>
          }
        </div>
      }
    </div>
  </div>
</div>
